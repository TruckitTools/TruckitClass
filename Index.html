<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TruckitClass</title>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
  <style>
    body { background-color: #000000; color: #00ff00; font-family: Arial, sans-serif; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #00ff00; text-shadow: 0 0 10px #00ff00; }
    h2 { color: #00ff00; text-align: center; }
    #search { width: 80%; max-width: 600px; padding: 15px; font-size: 18px; background: #111; border: 2px solid #00ff00; color: #00ff00; margin: 20px auto; display: block; }
    #results { max-width: 800px; margin: 0 auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #00ff00; padding: 10px; text-align: left; }
    th { background: #003300; }
    tr:nth-child(even) { background: #002200; }
    .no-results { text-align: center; color: #ff0000; font-style: italic; }
    footer { text-align: center; margin-top: 50px; font-size: 12px; color: #008800; }

    /* Calculator styles */
    #calculator { max-width: 600px; margin: 40px auto; padding: 20px; background: #111; border: 2px solid #00ff00; }
    label { display: block; margin: 10px 0 5px; }
    input { width: 100%; padding: 10px; background: #000; border: 1px solid #00ff00; color: #00ff00; }
    button { margin-top: 20px; padding: 10px 20px; background: #003300; border: 2px solid #00ff00; color: #00ff00; font-size: 16px; cursor: pointer; }
    button:hover { background: #005500; }
    #calc-result { margin-top: 20px; font-size: 18px; text-align: center; }
    .note { font-size: 12px; color: #00aa00; text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>TruckitClass</h1>
  <p style="text-align:center;">Search for a commodity to find its NMFC code and freight class</p>
  <input type="text" id="search" placeholder="e.g., bricks, furniture, computers..." autofocus>
  <div id="results"></div>

  <h2>Density-Based Freight Class Calculator (2025 NMFC)</h2>
  <div id="calculator">
    <p style="text-align:center;">For density-based items (common post-2025 updates). Enter shipment details:</p>
    <label>Number of identical pieces (optional, default 1):</label>
    <input type="number" id="pieces" min="1" value="1">

    <label>Length (inches, per piece):</label>
    <input type="number" id="length" min="0" step="0.1">

    <label>Width (inches, per piece):</label>
    <input type="number" id="width" min="0" step="0.1">

    <label>Height (inches, per piece, including pallet):</label>
    <input type="number" id="height" min="0" step="0.1">

    <label>Total weight (lbs, entire shipment):</label>
    <input type="number" id="weight" min="0" step="0.1">

    <button onclick="calculateDensity()">Calculate Class</button>
    <div id="calc-result"></div>
    <p class="note">Include pallet height/weight. Measure outermost dimensions. This is an estimate—special handling/liability may override.</p>
  </div>

  <footer>Note: Commodity search based on common items. Density calculator uses 2025 NMFC 13-tier scale. For official/precise classification, use NMFTA ClassIT+ (paid). Data approximate.</footer>

  <script>
    // Commodity search (unchanged)
    fetch('data/nmfc.json')
      .then(response => response.json())
      .then(data => {
        const fuse = new Fuse(data, {
          keys: ['description'],
          threshold: 0.4,
          includeScore: true
        });

        const resultsDiv = document.getElementById('results');
        const searchInput = document.getElementById('search');

        function performSearch() {
          const query = searchInput.value.trim();
          if (!query) {
            resultsDiv.innerHTML = '';
            return;
          }
          const results = fuse.search(query);
          if (results.length === 0) {
            resultsDiv.innerHTML = '<p class="no-results">No matches found. Try different keywords or use the density calculator below for density-based items.</p>';
            return;
          }
          let table = '<table><tr><th>Description</th><th>NMFC Code</th><th>Freight Class</th></tr>';
          results.forEach(result => {
            const item = result.item;
            table += `<tr><td>\( {item.description}</td><td> \){item.nmfc}</td><td>${item.class}</td></tr>`;
          });
          table += '</table>';
          resultsDiv.innerHTML = table;
        }

        searchInput.addEventListener('input', performSearch);
      });

    // Density calculator
    function calculateDensity() {
      const pieces = parseFloat(document.getElementById('pieces').value) || 1;
      const length = parseFloat(document.getElementById('length').value);
      const width = parseFloat(document.getElementById('width').value);
      const height = parseFloat(document.getElementById('height').value);
      const weight = parseFloat(document.getElementById('weight').value);

      if (!length || !width || !height || !weight) {
        document.getElementById('calc-result').innerHTML = '<p style="color:#ff0000;">Please fill all fields.</p>';
        return;
      }

      const cubicInchesPerPiece = length * width * height;
      const totalCubicInches = cubicInchesPerPiece * pieces;
      const totalCubicFeet = totalCubicInches / 1728;
      const density = weight / totalCubicFeet;

      let freightClass;
      if (density >= 50) freightClass = 50;
      else if (density >= 35) freightClass = 55;
      else if (density >= 30) freightClass = 60;
      else if (density >= 22.5) freightClass = 65;
      else if (density >= 15) freightClass = 70;
      else if (density >= 13.5) freightClass = 85;
      else if (density >= 12) freightClass = 92.5;
      else if (density >= 10) freightClass = 100;
      else if (density >= 9) freightClass = 125;
      else if (density >= 7) freightClass = 150;
      else if (density >= 6) freightClass = 175;
      else if (density >= 5) freightClass = 200;
      else if (density >= 4) freightClass = 250;
      else if (density >= 3) freightClass = 300;
      else if (density >= 2) freightClass = 400;
      else freightClass = 500;

      document.getElementById('calc-result').innerHTML = `
        <p><strong>Total Volume:</strong> ${totalCubicFeet.toFixed(2)} ft³</p>
        <p><strong>Density:</strong> ${density.toFixed(2)} lbs/ft³</p>
        <p><strong>Estimated Freight Class:</strong> ${freightClass}</p>
      `;
    }
  </script>
</body>
</html>
